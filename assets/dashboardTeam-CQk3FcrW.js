import{c as Y,j as e,r as l,n as A,o as H,x as $,v as z,w as Z,T as _,P as W,t as B}from"./auth-CqMHJIpH.js";import{H as q}from"./header-Xe48X9QU.js";Y.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(G,{})}));class h{name;description;role;photoUrl;photoFile;photoId;id;constructor(i){this.name=i.name,this.description=i.description,this.role=i.role,this.photoUrl=i.photoUrl,this.photoFile=i.photoFile,this.photoId=i.photoId,this.id=i.id}}const w=220,M=400;function X({file:x,onConfirm:i,onCancel:g}){const[j,L]=l.useState(1),[m,C]=l.useState({x:0,y:0}),[y,r]=l.useState(!1),p=l.useRef({x:0,y:0,panX:0,panY:0}),[c,f]=l.useState(null),[n]=l.useState(()=>URL.createObjectURL(x));if(l.useEffect(()=>{const s=new Image;return s.onload=()=>f({w:s.naturalWidth,h:s.naturalHeight}),s.src=n,()=>URL.revokeObjectURL(n)},[n]),!c)return e.jsx("div",{className:"loader"});const u=w/Math.min(c.w,c.h),R=c.w*u,v=c.h*u,U=s=>{s.preventDefault(),s.target.setPointerCapture(s.pointerId),r(!0),p.current={x:s.clientX,y:s.clientY,panX:m.x,panY:m.y}},b=s=>{if(!y)return;const S=s.clientX-p.current.x,P=s.clientY-p.current.y;C({x:p.current.panX+S,y:p.current.panY+P})},T=()=>r(!1),D=()=>{const s=u*j,S=w/2+m.x-c.w*s/2,P=w/2+m.y-c.h*s/2,F=Math.max(0,-S/s),E=Math.max(0,-P/s),I=w/s,t=Math.min(I,c.w-F),o=Math.min(I,c.h-E),a=Math.min(t,o),d=document.createElement("canvas");d.width=M,d.height=M;const N=d.getContext("2d");N.fillStyle="#f6fbfd",N.fillRect(0,0,M,M);const k=new Image;k.onload=()=>{N.drawImage(k,F,E,a,a,0,0,M,M),d.toBlob(O=>{O&&i(new File([O],x.name.replace(/\.\w+$/,".jpg"),{type:"image/jpeg"}))},"image/jpeg",.92)},k.src=n};return e.jsxs("div",{className:"photo-cropper",children:[e.jsx("p",{className:"photo-cropper-hint",children:"Drag to reposition. Use slider to zoom."}),e.jsx("div",{className:"photo-cropper-viewport",onPointerDown:U,onPointerMove:b,onPointerUp:T,style:{width:w,height:w},children:e.jsx("img",{src:n,alt:"Crop preview",style:{position:"absolute",width:`${R}px`,height:`${v}px`,left:"50%",top:"50%",transform:`translate(-50%, -50%) translate(${m.x}px, ${m.y}px) scale(${j})`,transformOrigin:"center center",pointerEvents:"none",userSelect:"none"},draggable:!1})}),e.jsxs("div",{className:"photo-cropper-controls",children:[e.jsx("label",{children:"Zoom"}),e.jsx("input",{type:"range",min:"1",max:"3",step:"0.02",value:j,onChange:s=>L(parseFloat(s.target.value))})]}),e.jsxs("div",{className:"photo-cropper-actions",children:[e.jsx("button",{className:"btn-primary",type:"button",onClick:D,children:"Confirm Crop"}),e.jsx("button",{className:"btn-danger",type:"button",onClick:g,children:"Cancel"})]})]})}function G(){const[x,i]=l.useState(null),[g,j]=l.useState([]),[L,m]=l.useState(!1),[C,y]=l.useState(!1),[r,p]=l.useState(new h({name:"",description:"",role:""})),[c,f]=l.useState(null),[n,u]=l.useState(null),[R,v]=l.useState(null),[U,b]=l.useState(null);l.useEffect(()=>{A(t=>{}),H().then(t=>{const o=t.teamMembers.map((a,d)=>new h({name:a.name,description:a.description,role:a.role,photoUrl:a.photo.url,photoId:a.photo.id,id:d.toString()}));j(o),i(t)})},[]);const T=()=>{!r.name.trim()||!r.description.trim()||(j([...g,new h({...r})]),p(new h({name:"",description:"",role:""})),v(null),m(!0))},D=t=>{f(t),u(new h({...g[t]}))},s=(t,o)=>{n&&u(new h({...n,[t]:o}))},S=t=>{n&&u(new h({...n,photoFile:t}))},P=t=>{if(!n)return;const o=[...g];o[t]=new h({...n}),j(o),f(null),u(null),b(null),m(!0)},F=()=>{f(null),u(null),b(null)},E=t=>{j(g.filter((o,a)=>a!==t)),m(!0),c===t&&(f(null),u(null))},I=async()=>{if(!x)return;y(!0);const t=[];for(const a of g){let d=new $({url:a.photoUrl||"",id:a.photoId||""});a.photoUrl&&a.photoFile&&await z(d),a.photoFile&&(d=await Z(a.photoFile,`Team Member ${a.name}`)),t.push(new _({name:a.name,description:a.description,role:a.role,photo:new $({url:d.url,id:d.id})}))}for(const a of x.teamMembers)t.find(N=>N.name===a.name)||await z(a.photo);const o=W.fromMap({...x.toMap(),teamMembers:t.map(a=>a.toMap())});await B(o),m(!1),y(!1),i(o)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{isDashboardTeamPage:!0}),x?e.jsx(e.Fragment,{children:e.jsxs("section",{className:"dashboard-section light",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("h1",{children:"Team Members"}),e.jsx("p",{children:"Manage team members shown on the main website."})]}),e.jsxs("div",{className:"team-dashboard-content",children:[e.jsxs("div",{className:"team-dashboard-list",children:[g.length===0&&e.jsx("div",{style:{textAlign:"center"},children:"No team members yet."}),g.map((t,o)=>e.jsx("div",{className:"team-dashboard-item",children:c===o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",className:"input-light",value:n?.name||"",onChange:a=>s("name",a.target.value)})]}),e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Role:"}),e.jsx("input",{type:"text",className:"input-light",value:n?.role||"",onChange:a=>s("role",a.target.value)})]}),e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Description:"}),e.jsx("textarea",{className:"input-light",value:n?.description||"",onChange:a=>s("description",a.target.value)})]}),e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Photo:"}),U?e.jsx(X,{file:U,onConfirm:a=>{S(a),b(null)},onCancel:()=>b(null)}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",className:"input-light",accept:"image/*",onChange:a=>{a.target.files&&a.target.files[0]&&b(a.target.files[0])}}),n?.photoFile&&e.jsx("img",{src:URL.createObjectURL(n.photoFile),alt:"Preview",className:"team-dashboard-thumbnail"}),n?.photoUrl&&!n?.photoFile&&e.jsx("img",{src:n.photoUrl,alt:"Preview",className:"team-dashboard-thumbnail"})]})]}),e.jsxs("div",{className:"team-dashboard-actions",children:[e.jsx("button",{className:"btn-primary",onClick:()=>P(o),children:"Save"}),e.jsx("button",{className:"btn-danger",onClick:F,children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"team-dashboard-item-preview",children:[e.jsx("img",{src:t.photoFile!=null?URL.createObjectURL(t.photoFile):t.photoUrl?t.photoUrl:"",alt:t.name,className:"team-dashboard-thumbnail"}),e.jsxs("div",{className:"team-dashboard-item-info",children:[e.jsx("h4",{children:t.name}),t.role&&e.jsx("p",{children:e.jsx("strong",{children:t.role})}),e.jsx("p",{children:t.description})]})]}),e.jsxs("div",{className:"team-dashboard-actions",children:[e.jsx("button",{className:"btn-primary",onClick:()=>D(o),children:"Edit"}),e.jsx("button",{className:"btn-danger",onClick:()=>E(o),children:"Delete"})]})]})},o))]}),e.jsxs("div",{className:"team-dashboard-add",children:[e.jsx("h3",{style:{margin:"0 0 1rem 0"},children:"Add New Team Member"}),e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",className:"input-light",placeholder:"Team member name",value:r.name,onChange:t=>p(new h({...r,name:t.target.value}))})]}),e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Role:"}),e.jsx("input",{type:"text",className:"input-light",placeholder:"e.g. President, Treasurer",value:r.role,onChange:t=>p(new h({...r,role:t.target.value}))})]}),e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Description:"}),e.jsx("textarea",{className:"input-light",placeholder:"Description",value:r.description,onChange:t=>p(new h({...r,description:t.target.value}))})]}),e.jsxs("div",{className:"team-form-group",children:[e.jsx("label",{children:"Photo:"}),R?e.jsx(X,{file:R,onConfirm:t=>{p(new h({...r,photoFile:t})),v(null)},onCancel:()=>v(null)}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",className:"input-light",accept:"image/*",onChange:t=>{t.target.files&&t.target.files[0]&&v(t.target.files[0])}}),r.photoFile&&e.jsx("img",{src:URL.createObjectURL(r.photoFile),alt:"Preview",className:"team-dashboard-thumbnail"})]})]}),e.jsx("button",{className:"btn-primary",onClick:T,children:"Add Team Member"})]}),L&&!C&&e.jsx("button",{className:"btn-primary",onClick:I,children:"Save Changes"}),C&&e.jsx("div",{className:"loader"})]})]})}):e.jsx("div",{className:"loader-container",children:e.jsx("div",{className:"loader"})})]})}
